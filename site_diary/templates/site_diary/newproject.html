{% extends "site_diary/layout_format.html" %}
{% load static %}

{% block head %}
    <title>New Project Entry | Triple G BuildHub</title>
    <link rel="stylesheet" href="{% static 'css/sitecss/global-footer.css' %}">
    <link rel="stylesheet" href="{% static 'css/sitecss/reports.css' %}">   
    <link rel="stylesheet" href="{% static 'css/sitecss/createblog.css' %}">
    <link rel="stylesheet" href="{% static 'css/sitecss/newproject.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .input-with-icon {
            position: relative;
            display: flex;
            align-items: center;
        }
        .currency-symbol {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #555;
            font-weight: 500;
            pointer-events: none;
        }
        .input-with-icon input[type="number"] {
            padding-left: 25px;
            width: 100%;
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
            appearance: textfield;
        }
    </style>
{% endblock %}

{% block body %}
    

    <!-- Main container -->
    <div class="container">
        <!-- Page header -->
        <div class="page-header">
            <div class="page-title">
                <i class="fas fa-plus-circle"></i>
                <h1>New Project Entry</h1>
            </div>
        </div>

        <!-- Project Entry Form -->
        <div class="filter-container">
            <div class="filter-header">
                <div class="filter-title">
                    <i class="fas fa-building"></i>
                    Project Details
                </div>
            </div>
            
            <form id="new-project-form">
                <div class="filter-options">
                    <!-- Project Name -->
                    <div class="filter-group">
                        <label for="project-name">Project Name <span class="required">*</span></label>
                        <input type="text" id="project-name" required>
                        <p class="error-message" id="name-error" style="display: none;">Project Name is required.</p>
                    </div>

                    <!-- Client Name -->
                    <div class="filter-group">
                        <label for="client-name">Client Name <span class="required">*</span></label>
                        <input type="text" id="client-name" required>
                        <p class="error-message" id="client-error" style="display: none;">Client Name is required.</p>
                    </div>

                    <!-- Project Code -->
                    <div class="filter-group">
                        <label for="project-code">Project Code</label>
                        <input type="text" id="project-code" placeholder="Auto-generated" readonly>
                    </div>

                    <!-- Project Location -->
                    <div class="filter-group">
                        <label for="project-location">Project Location <span class="required">*</span></label>
                        <input type="text" id="project-location" required>
                        <p class="error-message" id="location-error" style="display: none;">Project Location is required.</p>
                    </div>

                    <!-- Project Image Upload -->
                    <div class="filter-group">
                        <label for="project-image">Project Image (Optional)</label>
                        <input type="file" id="project-image" accept="image/png, image/jpeg">
                        <small>Supported formats: JPG, PNG. Max size: 2MB.</small>
                        <div class="image-preview" id="image-preview">
                            <img src="#" alt="Project Image Preview" id="image-output">
                            <button type="button" id="clear-image" class="btn btn-secondary">
                                <i class="fas fa-trash-alt"></i> Remove Image
                            </button>
                        </div>
                    </div>

                    <!-- Project Dates -->
                    <div class="filter-group">
                        <label for="start-date">Start Date <span class="required">*</span></label>
                        <input type="date" id="start-date" required>
                        <p class="error-message" id="date-error" style="display: none;">Start Date is required.</p>
                    </div>

                    <div class="filter-group">
                        <label for="end-date">Estimated End Date <span class="required">*</span></label>
                        <input type="date" id="end-date" required>
                        <p class="error-message" id="end-date-error" style="display: none;">End Date must be after the Start Date.</p>
                    </div>

                    <!-- Project Budget -->
                    <div class="filter-group">
                        <label for="project-budget">Project Budget (₱) <span class="required">*</span></label>
                        <div class="input-with-icon">
                            <span class="currency-symbol">₱</span>
                            <input type="text" id="project-budget" placeholder="Enter project budget" required>
                        </div>
                        <p class="error-message" id="budget-error" style="display: none;">Please enter a valid budget amount.</p>
                    </div>

                    <!-- Assigned Architect -->
                    <div class="filter-group">
                        <label for="assigned-architect">Assigned Architect <span class="required">*</span></label>
                        <input type="text" id="assigned-architect" required>
                        <p class="error-message" id="architect-error" style="display: none;">Assigned Architect is required.</p>
                    </div>
                    
                    <!-- Project Type -->
                    <div class="filter-group">
                        <label for="project-type">Project Type <span class="required">*</span></label>
                        <select id="project-type">
                            <option value="">Select Type</option>
                            <option value="residential">Residential</option>
                            <option value="commercial">Commercial</option>
                            <option value="industrial">Industrial</option>
                            <option value="infrastructure">Infrastructure</option>
                        </select>
                        <p class="error-message" id="type-error" style="display: none;">Project Type is required.</p>
                    </div>
                    
                    
                    
                    <!-- Project Description -->
                    <div class="filter-group">
                        <label for="project-description">Project Description</label>
                        <textarea id="project-description" rows="4" placeholder="Optional: Add project details or notes..."></textarea>
                    </div>
                </div>
                
                <!-- Form Buttons -->
                <div class="filter-buttons">
                    <button type="button" class="btn btn-secondary" id="reset-btn">
                        <i class="fas fa-undo"></i> Reset
                    </button>
                    <button type="submit" class="btn btn-primary" id="submit-btn">
                        <i class="fas fa-save"></i> Create Project
                    </button>
                </div>
            </form>
        </div>
    </div>
   

    <script>
        const form = document.getElementById("new-project-form");
        const projectName = form.querySelector("#project-name");
        const projectLocation = form.querySelector("#project-location");
        const architectName = form.querySelector("#assigned-architect");
        const projectType = form.querySelector("#project-type");
        const startDate = form.querySelector("#start-date");
        const endDate = form.querySelector("#end-date");
        const projectBudget = form.querySelector("#project-budget");
        const imageInput = form.querySelector("#project-image");
        const imagePreview = document.getElementById("image-preview");
        const imageOutput = document.getElementById("image-output");
        const clearImage = document.getElementById("clear-image");
        const budgetInput = document.getElementById('project-budget');

        // Image upload preview
        imageInput.addEventListener("change", (event) => {
            const file = event.target.files[0];
            if (file && (file.type === "image/jpeg" || file.type === "image/png")) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    imageOutput.src = e.target.result;
                    imagePreview.style.display = "block";
                };
                reader.readAsDataURL(file);
            } else {
                alert("Invalid file type! Please upload a JPG or PNG image.");
                event.target.value = "";
            }
        });

        if (budgetInput) {
    budgetInput.addEventListener('input', function(e) {
        // Remove all non-digit characters
        let value = this.value.replace(/[^0-9]/g, '');
        
        // Format with commas
        if (value.length > 0) {
            value = parseInt(value, 10).toLocaleString('en-PH');
        }
        
        this.value = value;
    });
}

// Update form validation to include budget
form.addEventListener('submit', (e) => {
    e.preventDefault();
    let valid = true;
        // Clear image preview
        clearImage.addEventListener("click", () => {
            imageInput.value = "";
            imagePreview.style.display = "none";
        });

        // Form validation before submission
        form.addEventListener("submit", (e) => {
            e.preventDefault();

            let valid = true;

            // Validate required fields
            if (!projectName.value.trim()) {
                document.getElementById("name-error").style.display = "block";
                valid = false;
            }
            if (!projectLocation.value.trim()) {
                document.getElementById("location-error").style.display = "block";
                valid = false;
            }
            if (!architectName.value.trim()) {
                document.getElementById("architect-error").style.display = "block";
                valid = false;
            }
            if (!projectType.value) {
                document.getElementById("type-error").style.display = "block";
                valid = false;
            }

            if (!projectBudget.value || projectBudget.value <= 0) {
                document.getElementById("budget-error").style.display = "block";
                valid = false;
            }

            if (!startDate.value || !endDate.value || new Date(endDate.value) <= new Date(startDate.value)) {
                document.getElementById("end-date-error").style.display = "block";
                valid = false;
            }
            

            if (!budgetInput.value || budgetInput.value.replace(/[^0-9]/g, '') === '0') {
                document.getElementById("budget-error").style.display = "block";
                valid = false;
    }

    if (valid) {
        alert("Project created successfully!");
        form.reset();
        imagePreview.style.display = "none";
    }
});

            // Check validation result
            if (valid) {
                alert("Project created successfully!");
                form.reset();
                imagePreview.style.display = "none";
            }
        });

        // Hide errors on input change
        form.querySelectorAll("input, textarea, select").forEach((input) =>
            input.addEventListener("input", () => {
                input.nextElementSibling && (input.nextElementSibling.style.display = "none");
            })
        );
    </script>
   <script src="{% static 'js/sitejs/mobile-btn.js' %}"></script>
</body>
</html>
{% include "site_diary/navtemplate/layoutfooter.html" %}
{% endblock %}